#!/usr/bin/env node

const fs = require('fs');
const carbone = require('carbone');

const printUsage = () => {
  console.info('Usage: carbone-cli [input-file] [data-file] [output-file] [options]');
  console.info('  [input-file]\t\tTemplate in docx format');
  console.info('  [data-file]\t\tData file in json format');
  console.info('  [output-file]\t\tOutput file in docx format');
  console.info('  [options-file]\t\tOptional render parameters');
}

const getFile = file => {
  const res = fs.readFileSync(file, "utf-8");
  return JSON.parse(res);
}

if (process.argv.length < 5) {
  printUsage();
  process.exit();
}

const inputFile = process.argv[2]
const dataFile = process.argv[3]
const outputFile = process.argv[4]
const optionsFile = process.argv[5]

console.log(inputFile);
console.log(dataFile);
console.log(outputFile);

const data = getFile(dataFile);

let options = {};
if (optionsFile) {
  console.log(optionsFile);
  options = getFile(optionsFile);
}

carbone.render(inputFile, data, options, async (err, result) => {
  if (err) {
    return console.log(err);
  }
  await fs.writeFileSync(outputFile, result);
  process.exit();
});
